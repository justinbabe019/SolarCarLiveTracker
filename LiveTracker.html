<!DOCTYPE html>

<html>
  <head>
    <title>Astrum Live Tracker</title>
    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <meta name="google-signin-client_id" content="866896161838-06ntn1butf2aanvto43332mc81ojhvs6.apps.googleusercontent.com.apps.googleusercontent.com">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDVZHQT42ioKRW42uMt3ECCNZVSNwsYbTw&callback=initMap&libraries=&v=weekly" defer></script>
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 800px;
      }

      /* Optional: Makes the sample page fill the window. */
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>

    <script>
      "use strict";

      let map;
      let markers= [];
      let traceMarkers=[];
      let markerDates = [];
      let infowindows=[];

      const ausCenter = {lat: -25.363, lng: 131.044};
      const astrumPos=ausCenter;//test

      const startPos={lat: -12.4637, lng: 130.8444};
      const katherinePos={lat: -14.4520, lng: 132.2699};
      const dunmarraPos={lat: -16.679973, lng: 133.412624};
      const tennantCreekPos={lat: -19.6495, lng: 134.1910};
      const barrowCreekPos={lat: -21.3799, lng: 133.9756};
      const aliceSpringsPos={lat: -23.6980, lng:133.8807};
      const kulgeraPos={lat: -25.8436, lng: 133.2879};
      const cooberPedyPos={lat: -29.0135, lng: 134.7544};
      const glendamboPos={lat: -30.9677, lng: 135.7513};
      const portAugustaPos={lat:-32.4936, lng: 137.7743};
      const endPos={lat: -34.928497, lng: 138.600739};
      
      gapi.load('auth2',function()
      {
         gapi.auth2.init();
      });

      function unifyInitIcon(URL){
         const thing2={
            url: URL,
            scaledSize: new google.maps.Size(80, 42),
            origin: new google.maps.Point(0, 0),
            anchor: new google.maps.Point(40, 25),
         }
         return thing2;
      }

      function setInitMarkers(map){
         /*
         const astrumIcon="https://imgur.com/a/W7pXawQ", 
            wscIcon="https://worldsolarchallenge.org/skin/2023/images/logo.svg", 
            endPointIcon="https://static.vecteezy.com/system/resources/previews/009/342/320/original/racing-flag-clipart-design-illustration-free-png.png";
         */
         const startPointMarker = new google.maps.Marker({
            position: startPos,
            icon: unifyInitIcon("https://worldsolarchallenge.org/skin/2023/images/logo.svg"),
            title: "startingPoint",
            map,
         })
         markers.push(startPointMarker);
         const katherineMarker = new google.maps.Marker({
            position: katherinePos,
            icon: unifyInitIcon("https://worldsolarchallenge.org/skin/2023/images/logo.svg"),
            title: "katherine",
            map,
         })
         markers.push(katherineMarker);
         const dunmarraMarker = new google.maps.Marker({
            position: dunmarraPos,
            icon: unifyInitIcon("https://worldsolarchallenge.org/skin/2023/images/logo.svg"),
            title: "dunmarra",
            map,
         })
         markers.push(dunmarraMarker);
         const tennantCreekMarker = new google.maps.Marker({
            position: tennantCreekPos,
            icon: unifyInitIcon("https://worldsolarchallenge.org/skin/2023/images/logo.svg"),
            title: "tennantCreek",
            map,
         })
         markers.push(tennantCreekMarker);
         const barrowCreekMarker = new google.maps.Marker({
            position: barrowCreekPos,
            icon: unifyInitIcon("https://worldsolarchallenge.org/skin/2023/images/logo.svg"),
            title: "barrowCreekMarker",
            map,
         })
         markers.push(barrowCreekMarker);
         const aliceSpringMarker = new google.maps.Marker({
            position: aliceSpringsPos,
            icon: unifyInitIcon("https://worldsolarchallenge.org/skin/2023/images/logo.svg"),
            title: "aliceSpring",
            map,
         })
         markers.push(aliceSpringMarker);
         const kulgeraMarker = new google.maps.Marker({
            position: kulgeraPos,
            icon: unifyInitIcon("https://worldsolarchallenge.org/skin/2023/images/logo.svg"),
            title: "kulgera",
            map,
         })
         markers.push(kulgeraMarker);
         const cooberPedyMarker = new google.maps.Marker({
            position: cooberPedyPos,
            icon: unifyInitIcon("https://worldsolarchallenge.org/skin/2023/images/logo.svg"),
            title: "cooberPedy",
            map,
         })
         markers.push(cooberPedyMarker);
         const glendamboMarker = new google.maps.Marker({
            position: glendamboPos,
            icon: unifyInitIcon("https://worldsolarchallenge.org/skin/2023/images/logo.svg"),
            title: "cooberPedy",
            map,
         })
         markers.push(glendamboMarker);
         const portAugustaMarker = new google.maps.Marker({
            position: portAugustaPos,
            icon: unifyInitIcon("https://worldsolarchallenge.org/skin/2023/images/logo.svg"),
            title: "portAugusta",
            map,
         })
         markers.push(portAugustaMarker);
         const endPointMarker = new google.maps.Marker({
            position: endPos,
            icon: unifyInitIcon("https://static.vecteezy.com/system/resources/previews/009/342/320/original/racing-flag-clipart-design-illustration-free-png.png"),
            title: "endingPoint",
            map,
         })
         markers.push(endPointMarker);

         addTraceMarker(startPos, "Astrum Current Position");
      }
      function setInitInfoWindow(){
         let contentString=["Darwin","Katherine", "Dunmarra", "Tennant Creek","Barrow Creek", "Alice Springs", "Kulgera", "Coober Pedy", "Glendambo", "Port Augusta", "Adelaide"];
         for(let i =0; i<contentString.length;++i){
            const infowondow= new google.maps.InfoWindow({
               content: contentString[i],
            });;
            infowindows.push(infowondow);
         }
      }

      function addTraceMarker(position, Label){
         const contentString='<a href="https://www.instagram.com/p/Cus0WYCunUy/?utm_source=ig_web_copy_link&igshid=MzRlODBiNWFlZA==">Check out our instagram!</a>';
         /*
         '<div id="content">' +
         '<div id="siteNotice">' +
         "</div>" +
         '<h1 id="firstHeading" class="firstHeading">Uluru</h1>' +
         '<div id="bodyContent">' +
         "<p><b>Uluru</b>, also referred to as <b>Ayers Rock</b>, is a large " +
         "sandstone rock formation in the southern part of the " +
         "Northern Territory, central Australia. It lies 335&#160;km (208&#160;mi) " +
         "south west of the nearest large town, Alice Springs; 450&#160;km " +
         "(280&#160;mi) by road. Kata Tjuta and Uluru are the two major " +
         "features of the Uluru - Kata Tjuta National Park. Uluru is " +
         "sacred to the Pitjantjatjara and Yankunytjatjara, the " +
         "Aboriginal people of the area. It has many springs, waterholes, " +
         "rock caves and ancient paintings. Uluru is listed as a World " +
         "Heritage Site.</p>" +
         '<p>Attribution: Instagram, <a href="https://www.instagram.com/p/Cus0WYCunUy/?utm_source=ig_web_copy_link&igshid=MzRlODBiNWFlZA==4">' +
         "https://www.instagram.com/p/Cus0WYCunUy/?utm_source=ig_web_copy_link&igshid=MzRlODBiNWFlZA==</a> " +
         "</p>" +
         "</div>" +
         "</div>";
         */

         const infowindow = new google.maps.InfoWindow({
            content: contentString,
            //ariaLabel: label,
         });
         const marker=new google.maps.Marker({
            position: position,
            label: Label,
            map,
         });
         marker.addListener("click", () => {
            infowindow.open({
               anchor: marker,
               map,
            });
         });
         traceMarkers.push(marker);
      }

      function initMap() {
         map = new google.maps.Map(document.getElementById("map"), {
            zoom: 5,
            center: ausCenter,
            fullscreenControl: false,
            zoomControl: true,
            streetViewControl: false
         });
         setInitMarkers(map);        
         setInitInfoWindow();

         ///////BACKDOOR FUNC/////// 
         map.addListener("click", (event) => {
            addTraceMarker(event.latLng, getDateInString()+"-"+getTimeInString());
         });
         ///////TESTING FUNC///////

         //match infowindows with markers
         for(let i=0;i<markers.length;i++){
            markers[i].addListener("click", () => {
            infowindows[i].open({
               anchor: markers[i],
               map,
            });
         });
         }
         
      }
      
      function showTrace(array) {
         for (let i = 0; i < array.length; i++) {
            array[i].setMap(map);
         }
      }
      function hideTrace() {
         for(let i = 0; i<traceMarkers.length -1; ++i){
            traceMarkers[i].setMap(null);
         }
      }
      function hideInitMarker(){
         for(let i = 0; i<markers.length; ++i){
            markers[i].setMap(null);
         }
      }
      function reCenter(){}

      function getDateInString(){
         var today = new Date();
         var date = (today.getMonth()+1)+'/'+today.getDate();
         return date;
      }   
      function getTimeInString(){
         var today = new Date(); 
         var time = today.getHours() + ":" + today.getMinutes() + ":" + today.getSeconds();
         return time;
      }
      function getAstrumPos(){
         var astrumNewPos=ausCenter;
         return astrumNewPos;
      }
      function updateLocation(){
         let loggedIn=false;
         checkLogIn(loggedIn);
         //loc={lat: 0, lng: 0};
         if(loggedIn){
            var today=new Date();
            var min=today.getMinutes();
            if(min%5 != 0)alert("Please wait until next available time update!");
            else addTraceMarker(getAstrumPos(), getDateInString()+"-"+getTimeInString());
         }
         else{
            alert("You are NOT authorised to update the location. JUST TAKE what is there now:) R U THE DUTCH");
         }
      }
      function checkLogIn(loggedIn){
         const contentString=
         '<div class="g-signin2" data-onsuccess="onSignIn"></div>';
         const infowindow=new google.maps.InfoWindow({
            content: contentString,
         });
         infowindow.open();
         var profile = googleUser.getBasicProfile();
         console.log('ID: ' + profile.getId()); // Do not send to your backend! Use an ID token instead.
         console.log('Name: ' + profile.getName());
         console.log('Image URL: ' + profile.getImageUrl());
         console.log('Email: ' + profile.getEmail()); // This is null if the 'email' scope is not present.
         alert("info window opened");
      }
      function onSignIn(){
         var profile = googleUser.getBasicProfile();
         console.log('ID: ' + profile.getId()); // Do not send to your backend! Use an ID token instead.
         console.log('Name: ' + profile.getName());
         console.log('Image URL: ' + profile.getImageUrl());
         console.log('Email: ' + profile.getEmail()); // This is null if the 'email' scope is not present.
      }
      function signOut(){
         var auth2 = gapi.auth2.getAuthInstance();
         auth2.signOut().then(function () {
            console.log('User signed out.');
         });
      }
      function distCal(){
         //look up google map platform
      }
    </script>
  </head>


   <body>
      <div id="floating-panel">
         <!--
            <input id="hide-trace" type="button" value="Hide Trace" />
            <input id="show-trace" type="button" value="Show Trace" />
         -->
         <button onclick="hideTrace()">Hide Trace</button>
         <button onclick="showTrace(traceMarkers)">Show Trace</button>
         <button onclick="hideInitMarker()">Hide Checkpoints</button>
         <button onclick="showTrace(markers)">Show Checkpoints</button>
         <button onclick="reCenter()">Re-Center</button>
         <button onclick="updateLocation()">Update Location</button>
         <button onclick="distCal()">Dist Cal</button>
         <button onclick="signOut()">Sign Out</button>
         <div class="g-signin2" data-onsuccess="onSignIn"></div>
      </div>
      <div id="map"></div>
   </body>

</html>